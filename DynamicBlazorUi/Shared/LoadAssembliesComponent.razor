@using DynamicBlazorUi.Services
@using System.Text.Json
@using DynamicBlazor.Api.Controllers
@inject IModuleAssemblyService ModuleAssemblyService
@inject NavigationManager NavigationManager

<div class="spinner-grow" role="status">
</div>

@code {
  protected override async Task OnInitializedAsync()
  {
    await base.OnInitializedAsync();
    using var client = new HttpClient();
    var res = await client.GetAsync("https://localhost:7192/Features");
    var content = await res.Content.ReadAsStringAsync();
    var features = JsonSerializer.Deserialize<List<Feature>>(content);
    if (await ModuleAssemblyService.GetAssemblies(features))
    {
      NavigationManager.NavigateTo(NavigationManager.Uri, forceLoad: true);
    }
  }

}